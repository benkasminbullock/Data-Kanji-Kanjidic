=encoding UTF-8

=head1 NAME

Data::Kanji::Kanjidic - parse the "kanjidic" kanji data file

=head1 SYNOPSIS

[% INCLUDE "example.pl" | xtidy %]

=head1 DESCRIPTION

This module's basic function is to read the entire Kanjidic file into
memory and create a data structure from it. The user then uses this
data structure for whatever purpose. Parsing Kanjidic takes a second
or two. Here the Kanjidic file is the as-downloaded text file in the
old format, rather than the new-format XML file.

There are several examples of the module's use in the F<examples>
directory of the distribution, including all the code in the module's
documentation.

=head1 FUNCTIONS

=head2 parse_kanjidic

[% INCLUDE "parse-kanjidic.pl" | xtidy %]

The input is the file name where Kanjidic may be found. The return
value is a hash reference. The keys of this hash reference are kanji,
encoded as Unicode. Each of the values of the hash reference are
entries corresponding to the kanji in the keys. Each value represents
one line of Kanjidic. Each is a hash reference, with the keys
described in L</parse_entry>.

This function assumes that the kanjidic file is encoded using the
EUC-JP encoding.

=head2 parse_entry

    my %values = parse_entry ($line);

Parse one line of Kanjidic. The input is one line from Kanjidic,
encoded as Unicode. The return value is a hash containing each field
from the line.

The possible keys and values of the returned hash are as
follows. Values are scalars unless otherwise mentioned.

=over

=item kanji

The kanji itself (the same as the key).

=item jiscode

The JIS code for the kanji in hexadecimal. This is a two-byte number
which identifies the kanji in the JIS X 0208 encoding scheme. See
L<http://www.sljfaq.org/afaq/encodings.html#encodings-JIS-X-0208>. The
JIS value is the second value in Kanjidic after the kanji in encoded
form and before the Unicode code point.

[% FOR key IN codes.keys.sort %]

=item [% key %]

[% codes.$key -%].
[%- IF has_dupes.$key %]
This may take multiple values, so the value is an array reference.
[%- END # has dupes -%]

[%- IF key == 'W' %] 

The following example program prints a list of Korean pronunciations,
romanized (requires L<Lingua::KO::Munja>).

[% INCLUDE "korean.pl" | xtidy %]
[%- ELSIF key == 'F' %]

The following example program prints a list of kanji from most to least
frequently used.

[% INCLUDE "frequency.pl" | xtidy %]
[%- ELSIF key == 'G' %]

This field is also used by kanjidic to give information on whether the
kanji is part of the Joyo or Jinmeiyo Kanji sets. If the grade is
between 1 and 8, the kanji is part of the Joyo Kanji. (See
L<http://www.sljfaq.org/afaq/jouyou-kanji.html> for details of the
Joyo Kanji.) If the grade is 9 or 10, then the kanji is not part of
the Joyo kanji, but it is part of the Jinmeiyo Kanji. (See
L<http://www.sljfaq.org/afaq/jinmeiyou-kanji.html>.)

See also L</grade>.

[%- END -%]

[%- END # for key %]

=item radical

This is the Kangxi radical of the kanji. This overrides Kanjidic's
preference for the Nelson radical. In other words, this is the same as
the L</B> field for most kanji, but if a L</C> field exists, this is the value
of the C field rather than the B field.

=item kokuji

This has a true value (1) if the character is marked as a "kokuji" in
Kanjidic. See L<http://www.sljfaq.org/afaq/kokuji.html>.

=item english

This contains an array reference to the English-language meanings
given in Kanjidic. It may be undefined, if there are no
English-language meanings listed.

[% INCLUDE "english-to-kanji.pl" | xtidy %]

Given input like this,

[% INCLUDE "example.txt" | xtidy %]

it outputs this:

[% INCLUDE "example-out.txt" | xtidy %]

=item onyomi

This is an array reference which contains the I<on'yomi> (音読) of the
kanji. (See L<http://www.sljfaq.org/afaq/kanji-pronunciation.html>.)
It may be undefined, if no I<on'yomi> readings are listed. The
I<on'yomi> readings are in katakana, as per Kanjidic itself. It is
encoded in Perl's internal Unicode encoding.

The following example prints a list of kanji which have the same on'yomi:

[% INCLUDE "onyomi-same.pl" | xtidy %]

=item kunyomi

This is an array reference which contains the I<kun'yomi> (訓読) of
the kanji. (See
L<http://www.sljfaq.org/afaq/kanji-pronunciation.html>.) It may be
undefined, if no I<kun'yomi> readings are listed. The I<kun'yomi>
readings are in hiragana, as per Kanjidic itself. It is encoded in
Perl's internal Unicode encoding.

=item nanori

This is an array reference which contains I<nanori> (名乗り) readings
of the character. It may be undefined, if no I<nanori> readings are
listed. The I<nanori> readings are in hiragana, as per Kanjidic
itself. They are encoded in Perl's internal Unicode encoding.

=item morohashi

This is a hash reference containing data on the kanji's location in
the Morohashi 'Dai Kan-Wa Jiten' kanji dictionary. The hash reference
has the following keys.

=over

=item volume

The volume number of the character.

=item page

The page number of the character.

=item index

The index number of the character.

=back

If there is no information, this remains unset.

For example, to print all the existing values,

[% INCLUDE "morohashi.pl" | xtidy %]

=back

For detailed explanations of these codes, see L</Kanjidic>.

=head2 kanjidic_order

    my @order = kanjidic_order ($kanjidic_ref);

Given an input of the return value of L</parse_kanjidic>, this returns
a list of the kanji sorted by the stroke order (the S field) of the
elements of C<\%kanjidic>. Elements with the same stroke order are
sorted by radical (the B field). This also adds a new field "kanji_id"
to each of them so that the order can be reconstructed when referring
to elements.

This replicates the ordering of kanji in a kanji dictionary's index by
stroke order. See
L<http://www.sljfaq.org/afaq/using-a-kanji-dictionary.html> for more
on kanji dictionary ordering.

=head2 grade

    my $grade2 = grade ($kanjidic_ref, 2);

Given a school grade such as C<2> above, and the return value of
L</parse_kanjidic>, C<$kanjidic_ref>, return an array reference
containing a list of all of the kanji from that grade. (See
L<http://www.sljfaq.org/afaq/education.html> for details of the
Japanese education system.)

The following example prints a list of the kanji from each school
grade to standard output:

[% INCLUDE "grades.pl" | xtidy %]

=head2 stroke_radical_jis_order

    @list = sort { stroke_radical_jis_order ($kanjidic, $a, $b) } @list;

This is a comparison function which sorts kanji C<$a> and C<$b>
according to stroke count, the L</S> field. If the stroke count is
identical, it sorts them according to L</radical>. If both the stroke
count and radical are the same, it sorts them according to
L</jiscode>.

=head1 SEE ALSO

=head2 Other Perl modules

=over

=item L<Lingua::JP::Kanjidic>

This module parses an old version of F<kanjidic>.

=back

=head2 Kanjidic

The official description of kanjidic is in
L<http://www.csse.monash.edu.au/~jwb/kanjidic.html>.  To download
F<kanjidic>, please go to this web page and then download it from the
link provided.

[% INCLUDE "author" %]
